{
   "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
   "name": "pine",
   "patterns": [
      {"include": "#script"},
      {
         "match": "\\b(indicator|library|strategy)\\b(?=\\()",
         "name": "entity.name.function.declaration"
      },
      {"include": "#annotations"},
      {"include": "#comments"},
      {
         "comment": "export? type name regex",
         "match": "(?<=^(export\\s+)?)(type|enum)\\s+([a-zA-Z_][a-zA-Z_0-9]*)\\b",
         "captures": {
            "1": {"name": "keyword.control.export"},
            "2": {"name": "keyword.type"},
            "3": {"name": "entity.name.type"}
         }
      },
      {
         "comment": "math functions",
         "match": "\\b(math)(\\s*\\.\\s*)(pi|phi|rphi|e|pow|min|max|abs|log|log10|sqrt|sign|exp|sin|cos|tan|asin|acos|atan|ceil|floor|round|round_to_mintick|todegrees|toradians|random|sum|avg)(?=\\s*\\()",
         "captures": {
            "1": {"name": "support.module"},
            "2": {"name": "punctuation.accessor"},
            "3": {"name": "support.function"}
         }
      },
      {
         "comment": "array functions (blocks ta and math due to conflicts with conflitcs with functions like min, max, sum, avg, etc.)",
         "match": "\\b(?!(?!array))(array)(\\s*\\.\\s*)(new_float|new_int|new_color|new_bool|new_string|new_line|new_box|new_table|new_label|new_linefill|copy|slice|size|get|min|max|push|range|sum|set|from|fill|insert|join|remove|pop|clear|sort|sort_indices|percentrank|percentile_nearest_rank|percentile_linear_interpolation|abs|binary_search|binary_search_leftmost|binary_search_rightmost|concat|avg|stdev|variance|covariance|mode|median|standardize|indexof|lastindexof|includes|shift|unshift|reverse|first|last|every|some)\\b(?=\\s*\\()",
         "captures": {
            "1": {"name": "support.type"},
            "2": {"name": "punctuation.accessor"},
            "3": {"name": "support.function"}
         }
      },
      {
         "comment": "matrix  functions",
         "match": "\\b(?!(?!matrix))(matrix)(\\s*\\.\\s*)(row|col|reshape|get|set|add_row|add_col|remove_row|remove_col|fill|submatrix|copy|columns|rows|elements_count|concat|swap_rows|swap_columns|reverse|sort|det|min|max|avg|median|mode|transpose|sum|diff|mult|pinv|inv|rank|trace|eigenvalues|eigenvectors|kron|pow|is_zero|is_identity|is_binary|is_symmetric|is_antisymmetric|is_diagonal|is_antidiagonal|is_triangular|is_stochastic|is_square)\\s*(?=\\s*\\()",
         "captures": {
            "1": {"name": "support.type"},
            "2": {"name": "punctuation.accessor"},
            "3": {"name": "support.function"}
         }
      },
      {
         "comment": "map functions",
         "match": "\\b(?!(?!map))(map)(\\s*\\.\\s*)(copy|size|get|contains|keys|values|put|put_all|remove|clear)\\s*(?=\\s*\\()",
         "captures": {
            "1": {"name": "support.type"},
            "2": {"name": "punctuation.accessor"},
            "3": {"name": "support.function"}
         }
      },
      {
         "comment": "highlights import, export, method, varip, var",
         "match": "\\b(import|export|method|var(?:ip)?)\\b(?=\\s+\\w)",
         "name": "keyword.control"
      },
      {
         "comment": "blocks built in namespaces, for highlighting built-in methods",
         "match": "\\b(?!adjustment|alert|array|barmerge|barstate|box|chart|closedtrades|color|commission|currency|dayofweek|direction|display|dividends|earnings|extend|font|format|hline|imported|input|label|line|linefill|location|log|map|math|matrix|method|oca|opentrades|order|plot|point|polyline|position|request|risk|runtime|scale|session|shape|size|splits|str|strategy|syminfo|ta|table|text|ticker|timeframe|udt|xloc|yloc)(?<=[a-zA-Z_][a-zA-Z_0-9]*\\.)(copy|delete|get_left|get_right|get_top|get_bottom|set_left|set_lefttop|set_right|set_rightbottom|set_top|set_bottom|set_border_color|set_bgcolor|set_border_width|set_border_style|set_extend|set_text_font_family|set_text_halign|set_text_valign|set_text_size|set_text|set_text_color|set_text_wrap|set_x1|set_y1|set_xy1|set_x2|set_y2|set_xy2|set_xloc|set_color|set_style|set_width|get_x1|get_y1|get_x2|get_y2|get_price|get_line1|get_line2|set_x|set_y|set_xy|set_yloc|set_textcolor|set_size|set_textalign|set_tooltip|get_x|get_y|get_text|slice|size|first|last|every|some|get|min|max|range|sum|set|fill|insert|join|push|remove|pop|clear|sort|sort_indices|percentrank|percentile_nearest_rank|percentile_linear_interpolation|abs|binary_search|binary_search_leftmost|binary_search_rightmost|concat|avg|stdev|variance|covariance|mode|median|standardize|indexof|lastindexof|includes|shift|unshift|reverse|set_position|set_frame_color|set_frame_width|cell|cell_set_text|cell_set_text_font_family|cell_set_tooltip|cell_set_width|cell_set_height|cell_set_text_color|cell_set_text_halign|cell_set_text_valign|cell_set_text_size|cell_set_bgcolor|row|col|reshape|add_row|add_col|remove_row|remove_col|submatrix|columns|rows|elements_count|swap_rows|swap_columns|det|transpose|diff|mult|pinv|inv|rank|trace|eigenvalues|eigenvectors|kron|pow|is_zero|is_identity|is_binary|is_symmetric|is_antisymmetric|is_diagonal|is_antidiagonal|is_triangular|is_stochastic|is_square|merge_cells|copy|set_first_point|set_second_point|set_point|set_top_left_point|set_bottom_right_point|contains|keys|values|put|put_all)\\b(?=\\s*\\()",
         "captures": {"1": {"name": "support.function"}}
      },
      {
         "comment": "Not-a-Number value",
         "match": "\\bna\\b(?!\\s*\\()",
         "name": "constant.language.null"
      },
      {
         "comment": "Return type arrow",
         "match": "\\)\\s*(→\\s+(?:\\[[^\\]]+\\]|[a-zA-Z_.<>]+(?:\\.[a-zA-Z_]+)?))",
         "captures": {
            "1": {"name": "keyword.operator.return"},
            "2": {"name": "entity.name.type"}
         }
      },
      {
         "comment": "highlights [....] in the hover over following ) → [..,...,..]",
         "match": "\\)\\s+(→\\s+(?:\\[(?:[^,\\]]+,\\s*)+[\\w_]+\\]|(?:\\w+\\.\\w+)|(?:(?!void|na)[\\w.><\\[\\]]+)))$",
         "captures": {"1": {"name": "keyword.type"}}
      },
      {"include": "#type-declaration"},
      {"include": "#keywords"},
      {"include": "#colors"},
      {"include": "#operators"},
      {"include": "#functions"},
      {"include": "#variables"},
      {"include": "#constants"},
      {"include": "#strings"},
      {"include": "#numbers"}
   ],
   "repository": {
      "script": {
         "patterns": [
            {
               "match": "^(\/\/)(@)(version)(=)(\\d+)",
               "captures": {
                  "1": {"name": "comment.line"},
                  "2": {"name": "entity.name.tag"},
                  "3": {"name": "entity.other.attribute-name"},
                  "4": {"name": "keyword.operator.assignment"},
                  "5": {"name": "constant.numeric.integer"}
               }
            },
            {
               "comment": "TradingView script URL",
               "match": "^(//\\s*)(ⓘ)(https://www.tradingview.com)([-\\w.,@?^=%&:/~+#{}]*)([a-zA-Z_][A-Za-z0-9_]*)",
               "captures": {
                  "1": {"name": "comment.line"},
                  "2": {"name": "comment.line"},
                  "3": {"name": "markup.underline.link"},
                  "4": {"name": "markup.underline.link"},
                  "5": {"name": "markup.underline.link"}
               }
            },
            {
               "comment": "Import statement",
               "match": "\\b(import)\\b\\s+(?:([a-zA-Z_][A-Za-z0-9_]*)\/)(?:([a-zA-Z_][A-Za-z0-9_]*)\\/)\\d+(?:\\s+as\\s+([a-zA-Z_][A-Za-z0-9_]*))?",
               "captures": {
                  "1": {"name": "keyword.control.import"},
                  "2": {"name": "entity.name.module"},
                  "3": {"name": "entity.name.module"},
                  "4": {"name": "storage.modifier"}
               }
            },
            {
               "match": "^(\/\/\\s*)(ⓘ)(https:\/\/www\\.tradingview\\.com)([-\\w.,@?^=%&:\/~+#{}]*)([a-zA-Z_][A-Za-z0-9_]*)(?=.*?\\n)",
               "captures": {
                  "1": {"name": "comment.line"},
                  "2": {"name": "comment.line"},
                  "3": {"name": "constant.numeric"},
                  "4": {"name": "markup.underline.link"},
                  "5": {"name": "markup.underline.link"},
                  "6": {"name": "markup.underline.link"}
               }
            }
         ]
      },
      "annotations": {
         "patterns": [
            {
               "comment": "Annotations with descriptions or markdown",
               "begin": "^(\/\/)\\s*(@)(type|description|function|returns|enum|variable|field|param|strategy_alert_message|version)(?:\\s+([a-zA-Z_][A-Za-z0-9_]*))?(?=[^\n]*)",
               "beginCaptures": {
                  "0": {"name": "comment.block.documentation"},
                  "1": {"name": "punctuation.definition.comment"},
                  "2": {"name": "entity.name.tag"},
                  "3": {"name": "entity.other.attribute-name"},
                  "4": {"name": "variable.parameter"}
               },
               "patterns": [
                  {"include": "#type-declaration"},
                  {
                     "match": "\\(\\s*(?:(?:array|matrix|map)<[^>]+>|(([a-zA-Z_][A-z0-9_]*\\.)?[a-zA-Z_][A-z0-9_]*))\\s*\\)",
                     "name": "storage.type"
                  },
                  {"include": "#markup"},
                  {"include": "#keywords"},
                  {"include": "#colors"},
                  {"include": "#operators"},
                  {"include": "#constants"},
                  {"include": "#strings"},
                  {"include": "#variables"},
                  {"include": "#functions"},
                  {"include": "#strings"},
                  {"include": "#numbers"}
               ],
               "end": "(?=^//\\s*@|^(?=\\s*(?!//)\\W))"
            }
         ]
      },
      "comments": {
         "patterns": [
            {
               "comment": "Single-line comments",
               "match": "//[^\\n]*$",
               "name": "comment.line"
            }
         ]
      },
      "markup": {
         "patterns": [
            {
               "begin": "(?=^\\/\\/)",
               "patterns": [
                  {
                     "match": "^\\/\\/\\s*(#+)\\s+([^\\n]*)",
                     "captures": {
                        "1": {"name": "punctuation.definition.heading"},
                        "2": {"name": "markup.heading.1"}
                     }
                  },
                  {
                     "match": "(?<=^\\/\\/\\s*|[^*])\\*\\*([^\\n*]+)\\*\\*(?=[^*]|$)",
                     "captures": {"1": {"name": "markup.bold"}}
                  },
                  {
                     "match": "^\\/\\/\\s*(-)\\s+([^\\n]*)",
                     "captures": {
                        "1": {"name": "punctuation.definition.list"},
                        "2": {"name": "markup.list.bullet"}
                     }
                  },
                  {
                     "match": "^\\/\\/\\s*(\\d+)(\\.)\\s+([^\\n]*)",
                     "captures": {
                        "1": {"name": "constant.numeric"},
                        "2": {"name": "punctuation.definition.list"},
                        "3": {"name": "markup.list.numbered"}
                     }
                  },
                  {
                     "match": "^\\/\\/\\s*(>)\\s+([^\\n]*)",
                     "captures": {
                        "1": {"name": "punctuation.definition.quote"},
                        "2": {"name": "markup.quote"}
                     }
                  },
                  {
                     "name": "markup.italic",
                     "match": "(?<=^\\/\\/\\s*|[^\\*])\\*([^\\n*]+)\\*(?=[^\\*]|$)",
                     "captures": {"1": {"name": "markup.italic"}}
                  },
                  {
                     "name": "markup.link",
                     "match": "\\[([^\\]]+)\\]\\(([^\\)]+)\\)",
                     "captures": {
                        "1": {"name": "markup.link.reference"},
                        "2": {"name": "markup.link.url"}
                     }
                  },
                  {
                     "name": "markup.raw.inline",
                     "match": "`([^`]+)`",
                     "captures": {"1": {"name": "markup.code"}}
                  },
                  {
                     "begin": "^\\/\\/\\s*```(pine\\w*)?(?=\\n)",
                     "contentName": "markup.raw.block",
                     "patterns": [
                        {"include": "#script"},
                        {"include": "#type-declaration"},
                        {"include": "#constants"},
                        {"include": "#keywords"},
                        {"include": "#operators"},
                        {"include": "#colors"},
                        {"include": "#functions"},
                        {"include": "#variables"},
                        {"include": "#strings"},
                        {"include": "#numbers"},
                        {"include": "$self"}
                     ],
                     "end": "(?=^\/\/\\s*```|^\\b|^\\/\\/\\s*@)"
                  },
                  {
                     "name": "markup.paragraph",
                     "match": "[^\\s]+[\\w\\s\\.,;:'\"\\-!?()]+"
                  }
               ],
               "end": "^(?=(\\b|\\/\\/\\s*@))"
            }
         ]
      },
      "keywords": {
         "patterns": [
            {
               "match": "(?<=[\\w\\n]\\s+)(and|or)\\b(?=\\s)|(?<=\\w\\s|=|^)\\b(not)\\b(?=\\s)",
               "name": "keyword.operator.logical"
            },
            {
               "match": "\\b(and|or|not)\\b",
               "name": "keyword.operator.logical"
            },
            {
               "comment": "hex colors",
               "match": "#([0-9a-fA-F]{6,8})\\b",
               "captures": {"0": {"name": "constant.numeric.hex"}}
            },
            {
               "match": "(?<=^|=)\\s*(if|switch|else\\s+if|while|for|else)\\b",
               "name": "keyword.control.conditional"
            },
            {
               "match": "\\s(in|to|by)\\s",
               "name": "keyword.control"
            },
            {
               "comment": "Arggs",
               "begin": "(?<=\\(|,)(?=\\s*[a-zA-Z_][a-zA-Z_0-9]*\\s*=[^\\)\\,]+(?:\\)|,))(?=\\s*(?!=>))",
               "end": "(?==)",
               "patterns": [
                  {
                     "begin": "(?<=\\(|,|\\n)(?=\\s*[a-zA-Z_][a-zA-Z_0-9]*\\s*=)",
                     "end": "(?=\\s*=)",
                     "patterns": [
                        {
                           "match": "\\b[a-zA-Z_][a-zA-Z_0-9]*\\b",
                           "name": "variable.parameter"
                        }
                     ]
                  }
               ]
            },
            {
               "match": "(?<=for\\s+)\\s*(?:\\[\\s*([_A-Za-z]\\w*)\\s*,\\s*([_A-Za-z]\\w*)\\s*\\]|([_A-Za-z]\\w*))(?=\\s+in)",
               "captures": {
                  "1": {"name": "variable.parameter"},
                  "2": {"name": "variable.parameter"},
                  "3": {"name": "variable.parameter"}
               },
               "name": "keyword.control.loop"
            }
         ]
      },
      "type-declaration": {
         "patterns": [
            {
               "comment": "Built-in type keywords",
               "match": "\\b(bool|color|float|int|string|line|label|box|table|linefill|chart\\.point|polyline)(?:\\[\\](?=\\s))?\\b(?=\\s*$|\\s+\\w|\\s*\/\/)|\\b([a-zA-Z_]\\w*\\.)?([a-zA-Z_]\\w*)(?=\\s*\\[\\](?=\\s))\\b(?=\\s*$|\\s+\\w|\\s*\/\/)",
               "captures": {
                  "0": {"name": "storage.type"},
                  "1": {"name": "storage.type"},
                  "2": {"name": "storage.type"}
               }
            },
            {
               "comment": "Improved type highlighting within <...>",
               "match": "(?<=(?:^|var\\s|varip\\s|\\(|,))(?:\\s*\\b(?:simple|series|input|const)\\b\\s+)?(?<!\\/\\/.*)\\s*(?:(array|matrix|map)<(?:(?:([a-zA-Z_][a-zA-Z_0-9]*),)?\\s*(?:(?:([a-zA-Z_][a-zA-Z_0-9]*)\\.)?([a-zA-Z_][a-zA-Z_0-9]*)))>|\\b(?!if|for|while|switch|else|export|method|type|var|varip|simple|series|input|const)(?:(?:([a-zA-Z_][a-zA-Z_0-9]*)\\.)?([a-zA-Z_][a-zA-Z_0-9]*(?:\\s*\\[\\]\\s+)?)))(?=\\s+\\w)",
               "captures": {
                  "0": {"name": "punctuation.bracket"},
                  "1": {"name": "storage.type"},
                  "2": {"name": "entity.name.type"},
                  "4": {"name": "storage.type"},
                  "6": {"name": "storage.type"},
                  "3": {"name": "entity.name.type"},
                  "5": {"name": "entity.name.type"}
               }
            },
            {
               "comment": "fields/param types",
               "match": "(?:(?<=^|,|\\(|var|varip|simple|series|input|const)\\s*)(?:(array|matrix|map)<(?:(?:([a-zA-Z_][A-Za-z0-9_]*),)?(?:(?:([a-zA-Z_][A-Za-z0-9_]*)\\.)?([a-zA-Z_][a-zA-Z_0-9]*))>)|(?:([a-zA-Z_][A-Za-z0-9_]*)\\.)?([a-zA-Z_][a-zA-Z_0-9]*)(?:\\s*\\[\\](?=\\s))?)(?=\\s+[a-zA-Z_][A-Za-z0-9_]*(?:(?:(?:\\t| )*(?:=\\s*(?:(?:'.*')|(?:\".*\")|(?:\\d*(?:\\.(?:\\d+[eE]?\\d+)?\\d*|\\d+))|(?:#[a-fA-F0-9]{6,8})|(?:(?:[a-zA-Z_][A-Za-z0-9_]*\\.)*[a-zA-Z_][A-Za-z0-9_]*))))?))",
               "captures": {
                  "1": {"name": "storage.type"},
                  "2": {"name": "entity.name.type"},
                  "3": {"name": "storage.type"},
                  "4": {"name": "storage.type"},
                  "5": {"name": "storage.type"},
                  "6": {"name": "storage.type"}
               }
            },
            {
               "comment": "Improved type highlighting within <...>",
               "match": "(?<=^|\\s|,|\\()\\s*\\b(matrix|map|array)(?:\\.(new))?<((?:([a-zA-Z_][A-Za-z0-9_]*\\.)?[a-zA-Z_][A-Za-z0-9_]*\\,)?(?:([a-zA-Z_][A-Za-z0-9_]*\\.)?[a-zA-Z_][A-Za-z0-9_]*))>(?=\\s*\\(|\\s|$)",
               "captures": {
                  "1": {"name": "storage.type"},
                  "2": {"name": "keyword.operator.new"},
                  "3": {"name": "storage.type"},
                  "4": {"name": "storage.type"},
                  "5": {"name": "storage.type"}
               }
            },
            {
               "comment": "Improved type highlighting",
               "match": "\\b(?:([a-zA-Z_][A-Za-z0-9_]*\\.)?([a-zA-Z_][A-Za-z0-9_]*))\\.(new)(?=\\s*\\()",
               "captures": {
                  "1": {"name": "support.module"},
                  "2": {"name": "storage.type"},
                  "3": {"name": "keyword.operator.new"}
               }
            }
         ]
      },
      "strings": {
         "patterns": [
            {
               "patterns": [
                  {
                     "match": "(\")([^\"\\\\\\n]*(?:\\\\.[^\"\\\\\\n]*)*)(\")",
                     "name": "string.quoted.double",
                     "captures": {
                        "1": {"name": "punctuation.definition.string.begin"},
                        "3": {"name": "punctuation.definition.string.end"},
                        "2": {
                           "patterns": [
                              {
                                 "match": "\\\\.",
                                 "name": "constant.character.escape"
                              },
                              {
                                 "comment": "will leave text/numbers in curly braces inside of a string a different highlight than string",
                                 "match": "(\\{)([^}]*)(\\})",
                                 "captures": {
                                    "1": {"name": "punctuation.section.embedded.begin"},
                                    "2": {"name": "variable.other"},
                                    "3": {"name": "punctuation.section.embedded.end"}
                                 }
                              }
                           ]
                        }
                     }
                  },
                  {
                     "match": "(')([^'\\\\\\n]*(?:\\\\.[^'\\\\\\n]*)*)(')",
                     "name": "string.quoted.single",
                     "captures": {
                        "1": {"name": "punctuation.definition.string.begin"},
                        "2": {"name": "string.quoted.single"},
                        "3": {"name": "punctuation.definition.string.end"},
                        "4": {
                           "patterns": [
                              {
                                 "match": "\\\\.",
                                 "name": "constant.character.escape"
                              },
                              {
                                 "comment": "will leave text/numbers in curly braces inside of a string a different highlight than string",
                                 "match": "(\\{)([^}]*)(\\})",
                                 "captures": {
                                    "1": {"name": "punctuation.section.embedded.begin"},
                                    "2": {"name": "variable.other"},
                                    "3": {"name": "punctuation.section.embedded.end"}
                                 }
                              }
                           ]
                        }
                     }
                  }
               ]
            }
         ]
      },
      "colors": {
         "patterns": [
            {
               "comment": "Hex color codes",
               "match": "\\b#([0-9a-fA-F]{6}|[0-9a-fA-F]{8})\\b",
               "captures": {"0": {"name": "constant.numeric.hex"}}
            },
            {
               "comment": "Predefined color constants",
               "match": "\\bcolor\\.(aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|purple|red|silver|teal|white|yellow)\\b",
               "captures": {
                  "0": {"name": "support.constant"},
                  "1": {"name": "constant.other"}
               }
            },
            {
               "comment": "Predefined color constants",
               "match": "\\bcolor\\.rgb\\s*\\((?:(\\s*\\d+(?:\\.\\d*)?\\s*),)(?:(\\s*\\d+(?:\\.\\d*)?\\s*),)(?:(\\s*\\d+(?:\\.\\d*)?\\s*))(?:,(?:(?:\\s*\\d+(?:\\.\\d*)?\\s*)))?\\)",
               "captures": {
                  "0": {"name": "support.constant"},
                  "1": {"name": "constant.numeric.integer"},
                  "2": {"name": "constant.numeric.integer"},
                  "3": {"name": "constant.numeric.integer"}
               }
            }
         ]
      },
      "constants": {
         "patterns": [
            {
               "comment": "special type highlighting regex",
               "match": "(?<=(?:,|\\(|^|var\\s|varip\\s)\\s*)\\b(simple|literal|series|const|plot)\\b(?=\\s+[^\\W])",
               "name": "storage.modifier"
            },
            {
               "comment": "highlights variables with all caps",
               "match": "(?<!\/\/.*|\\.)\\b([A-Z_][A-Z0-9_]*)\\b(?=\\s*[^\\(\\.])",
               "name": "variable.other.constant"
            },
            {
               "match": "\\b(true|false|na)\\b",
               "name": "constant.language.boolean"
            },
            {
               "comment": "built in constants, ie: location.abovebar.pine",
               "match": "\\b(color|line|label|box|table|linefill|chart\\.point|polyline|adjustment|alert|array|bar_index|barmerge|barstate|box|chart|close|currency|dayofmonth|dayofweek|display|dividends|earnings|extend|font|format|high|hl2|hlc3|hlcc4|hline|hour|input|label|last_bar_index|last_bar_time|line|linefill|location|log|low|map|math|matrix|minute|month|na|ohlc4|open|order|plot|polyline|position|request|runtime|scale|second|session|shape|size|splits|str|strategy|syminfo|ta|table|text|ticker|time|time_close|time_tradingday|timeframe|timenow|volume|weekofyear|xloc|year|yloc)\\.([A-Za-z][A-Za-z0-9_]*)\\b(?=\\s*[^\\(\\.])",
               "captures": {
                  "1": {"name": "support.constant"},
                  "0": {"name": "variable.other.constant"}
               }
            },
            {
               "comment": "private, ie: _mything.whatever.pine",
               "match": "\\b(?:(_[_A-Za-z][A-Za-z0-9_]*)\\.)+([a-zA-Z_][A-Za-z0-9_]*)\\b(?=[^\\w\\(\\.])",
               "captures": {
                  "0": {"name": "variable.other.constant"},
                  "1": {"name": "entity.name.section"},
                  "2": {"name": "entity.other.attribute-name"}
               }
            },
            {
               "match": "(?<!\/\/.*|\\.)\\b[A-Z_][A-Z0-9_]*\\b(?=\\s*[^\\(])",
               "name": "constant.other"
            }
         ]
      },
      "functions": {
         "patterns": [
            {
               "comment": "",
               "match": "(?<!\/\/.*|\\.)\\b(alert|alertcondition|barcolor|bgcolor|bool|line|label|table|box|linefill|color|dayofmonth|dayofweek|fill|fixnan|float|hline|hour|input|int|max_bars_back|minute|month|na|nz|plot|plotarrow|plotbar|plotcandle|plotchar|plotshape|second|string|time|time_close|timestamp|weekofyear|year)(?=\\s*\\()",
               "name": "entity.name.function"
            },
            {
               "match": "\\b(log)\\.(?:(info)|(error)|(warning))(?=\\s*\\()",
               "captures": {
                  "1": {"name": "support.module"},
                  "2": {"name": "token.info-token"},
                  "3": {"name": "token.error-token"},
                  "4": {"name": "token.warn-token"}
               }
            },
            {
               "comment": "Function calls",
               "match": "\\b(chart\\.point|runtime|log|ticker|timeframe|syminfo|color|math|timeframe|request|ticker|str|ta|box|line|linefill|label|table|table|array|matrix)\\.([a-zA-Z_][A-Za-z0-9_]*)\\b(?=\\s*\\()",
               "captures": {
                  "0": {"name": "entity.name.function"},
                  "1": {"name": "support.module"},
                  "2": {"name": "support.function"}
               }
            },
            {
               "comment": "Function calls",
               "match": "\\b(?:(?!self|this|chart\\.point|runtime|log|ticker|timeframe|syminfo|color|math|timeframe|request|ticker|str|ta|box|line|linefill|label|table|table|array|matrix)([a-zA-Z0-9_]*(?:\\.))?([a-zA-Za-za-zA-Z0-9_]*(?:\\.))*)?([a-zA-Za-za-zA-Z0-9_]*)\\s*(?=\\([^\\\\)]*\\)(?=(?!\\s*=>)))",
               "captures": {
                  "1": {"name": "entity.name.function.support"},
                  "0": {"name": "entity.name.namespace"},
                  "2": {"name": "entity.name.namespace"},
                  "3": {"name": "entity.name.function.method"}
               }
            },
            {
               "comment": "user function regex",
               "match": "(?<!\/\/.*|\\.)\\b([_A-Za-z][_A-Za-z0-9]*)\\b(?=\\s*\\()|(?<=^(?:export\\s+|method\\s+)*)([_A-Za-z][_A-Za-z0-9]*)\\s*(?=\\([^\\)]*\\)\\s*(=>))",
               "captures": {
                  "1": {"name": "entity.name.function"},
                  "2": {"name": "entity.name.function"},
                  "3": {"name": "support.function"}
               }
            }
         ]
      },
      "operators": {
         "patterns": [
            {
               "match": "(\\+=|-=|\\*=|/=|%=|:=)",
               "name": "keyword.operator.assignment"
            },
            {
               "match": "\\B(==|!=|<=|>=|<|>)\\B",
               "name": "keyword.operator.comparison"
            },
            {
               "match": "(?<![-:!=><\\+*%\/])=(?=[^>=])",
               "name": "keyword.operator.assignment"
            },
            {
               "match": "(\\+|\\-|\\*|/|%)",
               "name": "keyword.operator.arithmetic"
            },
            {
               "match": "(\\?|\\:)",
               "name": "keyword.operator.ternary"
            },
            {
               "match": "(\\(|\\))",
               "name": "punctuation.bracket.round"
            },
            {
               "match": "(\\[|\\]|\\{|\\})",
               "name": "punctuation.bracket"
            },
            {
               "match": "\\b(→|continue|break)\\b",
               "name": "keyword.control.flow"
            }
         ]
      },
      "numbers": {
         "patterns": [
            {
               "match": "\\b([+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:[eE][+-]?\\d+)?\\b)",
               "captures": {"0": {"name": "constant.numeric"}}
            }
         ]
      },
      "variables": {
         "patterns": [
            {
               "comment": "",
               "match": "\\b(bar_index|last_bar_index|last_bar_time|time|timenow|time_tradingday|time_close|close|high|hl2|hlc3|hlcc4|low|ohlc4|open|volume|abovebar|belowbar)\\b(?=(?![\\w\\(]|[\\-+\/%*:]=))",
               "name": "variable.language"
            },
            {
               "comment": "",
               "match": "\\b(dayofmonth|dayofweek|second|hour|minute|month|weekofyear|year)\\b(?=:?)(?!\\s*(?:=|:=))",
               "name": "variable.language"
            },
            {
               "match": "\\b(line|label|box|table|linefill|polyline)(?:\\s*\\.\\s*)(all)\\b",
               "name": "entity.name.constant"
            },
            {
               "match": "\\b(currency)(?:\\s*\\.\\s*)([A-Za-z]+)\\b",
               "captures": {
                  "1": {"name": "constant.language"},
                  "2": {"name": "constant.other"}
               }
            },
            {
               "comment": "",
               "match": "\\b(ta)(\\s*\\.\\s*)(wad|tr|vwap|obv|accdist|iii|nvi|pvi|pvt|wvad)(?=\\s*[^\\(])",
               "captures": {
                  "1": {"name": "support.module"},
                  "2": {"name": "punctuation.accessor"},
                  "3": {"name": "variable.other"}
               }
            },
            {
               "comment": "",
               "match": "\\b(strategy)\\s*\\.\\s*(max_runup|account_currency|cash|equity|eventrades|fixed|grossloss|grossprofit|initial_capital|long|losstrades|max_contracts_held_all|max_contracts_held_long|max_contracts_held_short|max_drawdown|netprofit|openprofit|percent_of_equity|position_avg_price|position_entry_name|position_size|short|wintrades)\\b",
               "captures": {
                  "0": {"name": "punctuation.accessor"},
                  "1": {"name": "support.module"},
                  "2": {"name": "variable.other.property"}
               }
            },
            {
               "comment": "",
               "match": "\\b(strategy)\\s*\\.\\s*(commission)\\s*\\.\\s*(cash_per_contract|cash_per_order|percent)\\b",
               "captures": {
                  "0": {"name": "punctuation.accessor"},
                  "1": {"name": "support.module"},
                  "2": {"name": "punctuation.accessor"},
                  "3": {"name": "variable.other.property"}
               }
            },
            {
               "comment": "",
               "match": "\\b(strategy)\\s*\\.\\s*(direction)\\s*\\.\\s*(all|long|short)\\b",
               "captures": {
                  "0": {"name": "punctuation.accessor"},
                  "1": {"name": "support.module"},
                  "2": {"name": "punctuation.accessor"},
                  "3": {"name": "variable.other.constant"}
               }
            },
            {
               "comment": "",
               "match": "\\b(strategy)\\s*\\.\\s*(oca)\\s*\\.\\s*(cancel|none|reduce)\\b",
               "captures": {
                  "0": {"name": "punctuation.accessor"},
                  "1": {"name": "support.module"},
                  "2": {"name": "punctuation.accessor"},
                  "3": {"name": "variable.other.constant"}
               }
            },
            {
               "comment": "",
               "match": "\\b(strategy)\\.((?:opentrades|closedtrades)(?=[^\\.])|(?:margin_liquidation_price|grossloss_percent|max_runup_percent|netprofit_percent|openprofit_percent|grossprofit_percent|max_drawdown_percent))\\b(?!\\s*\\()",
               "captures": {
                  "1": {"name": "support.module"},
                  "2": {"name": "variable.other.property"}
               }
            },
            {
               "comment": "",
               "match": "\\b(strategy)\\.(?:([a-zA-Z_]+)\\.)?([a-zA-Z_]+)(?=\\s*\\()\\b",
               "captures": {
                  "1": {"name": "support.module"},
                  "2": {"name": "entity.name.namespace"},
                  "3": {"name": "support.function.call"}
               }
            },
            {
               "comment": "",
               "match": "(?=(?:^|var\\s+|varip\\s+|\\(|,)\\s*).*\\b(?:(simple|series|input|const|literal)\\s+)(?:([a-zA-Z_]\\w*\\.)?([a-zA-Z_]\\w*))\\s*(?=(?:[a-zA-Z_]\\w*)\\s*(=|,|\\)))",
               "captures": {
                  "1": {"name": "storage.modifier"},
                  "2": {"name": "entity.name.namespace"},
                  "3": {"name": "variable.parameter"}
               }
            },
            {
               "comment": "",
               "match": "\\b(dayofmonth|dayofweek|second|hour|minute|month|weekofyear|year)(?!\\s*(?:=|:=))\\b",
               "name": "variable.language"
            },
            {
               "comment": "",
               "match": "\\b(math)\\s*\\.\\s*(e|phi|pi|rphi)\\b",
               "captures": {
                  "0": {"name": "punctuation.accessor"},
                  "1": {"name": "support.module"},
                  "2": {"name": "constant.numeric"}
               }
            },
            {
               "match": "\\b(?<=\\)|\\b(?:[a-zA-Z_]\\w*)\\b)\\.([a-zA-Z_][A-Za-z0-9_]*)\\b(?=\\s*[^\\(\\.])",
               "captures": {"1": {"name": "entity.other.attribute-name"}}
            },
            {
               "comment": "",
               "match": "(?<!\\.)\\b(line|label|box|table|linefill|polyline)\\s*\\.\\s*(all)\\b",
               "captures": {
                  "0": {"name": "punctuation.accessor"},
                  "1": {"name": "support.constant"},
                  "2": {"name": "variable.other.constant"}
               }
            },
            {
               "match": "\\b(?!this|self)([a-zA-Z_][A-Za-z0-9_]*)\\b(?=\\s*[^\\(\\.\\w])",
               "captures": {"1": {"name": "variable.name"}}
            },
            {
               "comment": "highlights 'this' and 'self'",
               "match": "(?<!\/\/.*)\\b(this|self)\\b\\s*(?=\\.\\w|\\s*(?:,|\\)|$))",
               "captures": {"1": {"name": "entity.name.selector"}}
            }
         ]
      }
   },
   "scopeName": "source.pine"
}